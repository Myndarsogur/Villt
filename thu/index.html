<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8">
  <title>Myndir og Tónlist</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      background: black;
    }

    #preview {
      position: fixed;
      width: 300px;
      height: 200px;
      bottom: 150px;
      right: 200px;
      z-index: 2;
      background: black;
    }

    #preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    #leftClickArea, #rightClickArea {
      position: fixed;
      top: 0;
      bottom: 0;
      width: 50%;
      z-index: 3;
    }

    #leftClickArea { left: 0; }
    #rightClickArea { right: 0; }
  </style>
</head>
<body>
  <!-- Bakgrunnsmynd verður sett inn sem <img> í JS -->
  <div id="preview"></div>
  <div id="leftClickArea"></div>
  <div id="rightClickArea"></div>
  <audio id="music" src="thu.mp3" autoplay loop></audio>

  <script>
    const totalImages = 49;
    const imagePaths = Array.from({ length: totalImages }, (_, i) => `thu2/mynd${i + 1}.gif`);

    // Preload myndirnar
    const preloadedImages = [];
    imagePaths.forEach((src) => {
      const img = new Image();
      img.src = src;
      preloadedImages.push(img);
    });

    // Bakgrunnur
    let currentBgIndex = 0;
    let backgroundImg;

    function showBackgroundImage(index) {
      const newBg = document.createElement('img');
      newBg.src = imagePaths[index] + '?t=' + Date.now();
      newBg.alt = 'bakgrunnur';
      newBg.style.position = 'fixed';
      newBg.style.top = '0';
      newBg.style.left = '0';
      newBg.style.width = '100%';
      newBg.style.height = '100%';
      newBg.style.objectFit = 'cover';
      newBg.style.zIndex = '0';

      if (backgroundImg) {
        document.body.removeChild(backgroundImg);
      }

      document.body.insertBefore(newBg, document.getElementById('preview'));
      backgroundImg = newBg;
    }

    // Byrja með fyrstu mynd
    showBackgroundImage(currentBgIndex);

    // Skipta á 5 sek fresti
    setInterval(() => {
      currentBgIndex = (currentBgIndex + 1) % totalImages;
      showBackgroundImage(currentBgIndex);
    }, 5000);

    // Preview
    const preview = document.getElementById('preview');
    const visited = [];
    let historyIndex = -1;

    function showPreviewImage(index) {
      const newImg = document.createElement('img');
      newImg.src = imagePaths[index] + '?t=' + Date.now();
      newImg.alt = 'forskoðun';
      newImg.style.width = '100%';
      newImg.style.height = '100%';
      newImg.style.objectFit = 'cover';
      preview.innerHTML = '';
      preview.appendChild(newImg);
    }

    function goForward() {
      if (historyIndex < visited.length - 1) {
        historyIndex++;
        showPreviewImage(visited[historyIndex]);
      } else {
        if (visited.length >= totalImages) {
          const current = visited[historyIndex];
          visited.length = 0;
          visited.push(current);
          historyIndex = 0;
        }

        let next;
        do {
          next = Math.floor(Math.random() * totalImages);
        } while (visited.includes(next));

        visited.push(next);
        historyIndex++;
        showPreviewImage(next);
      }
      resetInactivityTimer();
    }

    function goBack() {
      if (historyIndex > 0) {
        historyIndex--;
        showPreviewImage(visited[historyIndex]);
      }
      resetInactivityTimer();
    }

    // Smellir á skjá
    document.getElementById('rightClickArea').addEventListener('click', goForward);
    document.getElementById('leftClickArea').addEventListener('click', goBack);

    // Örvatakkar á lyklaborði
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight') {
        goForward();
      } else if (e.key === 'ArrowLeft') {
        goBack();
      }
    });

    // Sjálfvirk fletting eftir 5 sek
    let inactivityTimer;
    function resetInactivityTimer() {
      clearTimeout(inactivityTimer);
      inactivityTimer = setTimeout(() => {
        goForward();
      }, 5000);
    }

    // Byrja með eina mynd í preview
    goForward();

    // Spila lag við hvaða aðgerð sem er
    function startMusicOnce() {
      const music = document.getElementById('music');
      if (music.paused) {
        music.play().catch((e) => console.log('Ekki tókst að spila lagið:', e));
      }
      document.removeEventListener('click', startMusicOnce);
      document.removeEventListener('keydown', startMusicOnce);
      document.removeEventListener('mousedown', startMusicOnce);
    }

    document.addEventListener('click', startMusicOnce);
    document.addEventListener('keydown', startMusicOnce);
    document.addEventListener('mousedown', startMusicOnce);
  </script>
</body>
</html>
