<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8">
  <title>Myndir og Tónlist</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      background: black;
    }

    #background-img {
      position: fixed;
      width: 100%;
      height: 100%;
      object-fit: cover;
      top: 0;
      left: 0;
      z-index: 0;
    }

    #preview {
      position: fixed;
      width: 300px;
      height: 200px;
      bottom: 150px;
      right: 200px;
      z-index: 1;
      background: black;
    }

    #preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    #leftClickArea, #rightClickArea {
      position: fixed;
      top: 0;
      bottom: 0;
      width: 50%;
      z-index: 2;
    }

    #leftClickArea { left: 0; }
    #rightClickArea { right: 0; }
  </style>
</head>
<body>
  <img id="background-img" src="" alt="bakgrunnur">
  <div id="preview">
    <img id="preview-img" src="" alt="forskoðun">
  </div>
  <div id="leftClickArea"></div>
  <div id="rightClickArea"></div>
  <audio id="music" src="thu.mp3" autoplay loop></audio>

  <script>
    const totalImages = 49;
    const imagePaths = Array.from({ length: totalImages }, (_, i) => `thu2/mynd${i + 1}.gif`);

    // Preload myndirnar
    const preloadedImages = [];
    imagePaths.forEach((src) => {
      const img = new Image();
      img.src = src;
      preloadedImages.push(img);
    });

    // --- Bakgrunnur ---
    const backgroundImg = document.getElementById('background-img');
    let currentBgIndex = 0;

    backgroundImg.src = imagePaths[currentBgIndex] + '?t=' + Date.now();

    setInterval(() => {
      currentBgIndex = (currentBgIndex + 1) % totalImages;
      backgroundImg.src = imagePaths[currentBgIndex] + '?t=' + Date.now();
    }, 4900);

    // --- Preview ---
    const previewImg = document.getElementById('preview-img');
    const visited = [];
    let historyIndex = -1;

    function showPreviewImage(index) {
      previewImg.src = imagePaths[index] + '?t=' + Date.now(); // tryggir fresh load
    }

    function goForward() {
      if (historyIndex < visited.length - 1) {
        historyIndex++;
        showPreviewImage(visited[historyIndex]);
      } else {
        if (visited.length >= totalImages) {
          const current = visited[historyIndex];
          visited.length = 0;
          visited.push(current);
          historyIndex = 0;
        }

        let next;
        do {
          next = Math.floor(Math.random() * totalImages);
        } while (visited.includes(next));

        visited.push(next);
        historyIndex++;
        showPreviewImage(next);
      }
      resetInactivityTimer();
    }

    function goBack() {
      if (historyIndex > 0) {
        historyIndex--;
        showPreviewImage(visited[historyIndex]);
      }
      resetInactivityTimer();
    }

    // --- Smellir á skjá ---
    document.getElementById('rightClickArea').addEventListener('click', goForward);
    document.getElementById('leftClickArea').addEventListener('click', goBack);

    // --- Örvatakkar á lyklaborði ---
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight') {
        goForward();
      } else if (e.key === 'ArrowLeft') {
        goBack();
      }
    });

    // --- Sjálfvirk fletting eftir 5 sekúndur ---
    let inactivityTimer;
    function resetInactivityTimer() {
      clearTimeout(inactivityTimer);
      inactivityTimer = setTimeout(() => {
        goForward();
      }, 4900);
    }

    // Byrjar með fyrstu myndina
    goForward();

    // --- Spila lag við hvaða aðgerð sem er (smellur, örvar, takkar) ---
    function startMusicOnce() {
      const music = document.getElementById('music');
      if (music.paused) {
        music.play().catch((e) => console.log('Ekki tókst að spila lagið:', e));
      }
      document.removeEventListener('click', startMusicOnce);
      document.removeEventListener('keydown', startMusicOnce);
      document.removeEventListener('mousedown', startMusicOnce);
    }

    document.addEventListener('click', startMusicOnce);
    document.addEventListener('keydown', startMusicOnce);
    document.addEventListener('mousedown', startMusicOnce);
  </script>
</body>
</html>
